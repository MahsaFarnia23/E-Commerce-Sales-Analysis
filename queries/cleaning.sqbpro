<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="superstore.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="8424"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="Sample - Superstore" custom_title="0" dock_id="1" table="4,19:mainSample - Superstore"/><dock_state state="000000ff00000000fd00000001000000020000059700000381fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000005970000011800ffffff000002580000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Sample - Superstore" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="50"/><column index="2" value="117"/><column index="3" value="85"/><column index="4" value="85"/><column index="5" value="117"/><column index="6" value="78"/><column index="7" value="163"/><column index="8" value="93"/><column index="9" value="109"/><column index="10" value="132"/><column index="11" value="117"/><column index="12" value="73"/><column index="13" value="62"/><column index="14" value="124"/><column index="15" value="124"/><column index="16" value="93"/><column index="17" value="300"/><column index="18" value="78"/><column index="19" value="56"/><column index="20" value="57"/><column index="21" value="85"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1"></sql><sql name="SQL 2">--E-Commerce Sales Analysis
PRAGMA table_info(&quot;Sample - Superstore&quot;);
------------------------------------------
--objectives:
--Sales Trends
--Profitable Categories
--Customer Segmentation
--Discount Impact
--Regional Analysis
-----------------------------------------
SELECT * FROM &quot;Sample - Superstore&quot;;
--Data Preparation
--1. Convert date columns to the YYYY-MM-DD format
SELECT
    &quot;Order Date&quot;,
    printf(
        '%04d-%02d-%02d',
        substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
        substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
        substr(&quot;Order Date&quot;,
				instr(&quot;Order Date&quot;,'/') + 1,
				instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
        )
    ) AS order_date_iso
FROM &quot;Sample - Superstore&quot;
LIMIT 10;
---------------------------------------------------
--make a clean view
CREATE VIEW orders_clean AS
SELECT
    &quot;Row ID&quot;        AS row_id,
    &quot;Order ID&quot;      AS order_id,
    &quot;Order Date&quot;    AS order_date_raw,
    &quot;Ship Date&quot;     AS ship_date_raw,
    &quot;Ship Mode&quot;     AS ship_mode,
    &quot;Customer ID&quot;   AS customer_id,
    &quot;Customer Name&quot; AS customer_name,
    Segment         AS segment,
    Country         AS country,
    City            AS city,
    State           AS state,
    &quot;Postal Code&quot;   AS postal_code,
    Region          AS region,
    &quot;Product ID&quot;    AS product_id,
    Category        AS category,
    &quot;Sub-Category&quot;  AS sub_category,
    &quot;Product Name&quot;  AS product_name,
    Sales           AS sales,
    Quantity        AS quantity,
    Discount        AS discount,
    Profit          AS profit,
--standard_date
	printf(
        '%04d-%02d-%02d',
        substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
        substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
        substr(&quot;Order Date&quot;,
            instr(&quot;Order Date&quot;, '/') + 1,
            instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
        )
    ) AS order_date,

--Add year and month columns for trend analysis
	strftime(
        '%Y',
        printf(
            '%04d-%02d-%02d',
            substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
            substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
            substr(
                &quot;Order Date&quot;,
                instr(&quot;Order Date&quot;, '/') + 1,
                instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
            )
        )
    ) AS order_year,
    strftime(
        '%m',
        printf(
            '%04d-%02d-%02d',
            substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
            substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
            substr(
                &quot;Order Date&quot;,
                instr(&quot;Order Date&quot;, '/') + 1,
                instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
            )
        )
    ) AS order_month
FROM &quot;Sample - Superstore&quot;;
------------------------------
SELECT * FROM orders_clean 
-----------------------------------
--Overall KPIs
--main_values
SELECT
    COUNT(DISTINCT order_id)AS total_orders,
    ROUND(SUM(sales),2)AS total_sales,
    ROUND(SUM(profit),2)AS total_profit,
    ROUND(AVG(profit), 2)AS avg_profit_per_row
FROM orders_clean;

-----------------------------
--Sales by Year:
--Yearly sales grew significantly after 2015: while 2015 slightly underperformed 2014 in revenue, both 2016 and 2017 showed strong growth in both sales and profit.
--This suggests an improving business performance over time, potentially due to better product mix, pricing, or customer acquisition.
SELECT
    order_year,
    ROUND(SUM(sales), 2)  AS sales,
    ROUND(SUM(profit), 2) AS profit
FROM orders_clean
GROUP BY order_year
ORDER BY order_year;
------------------------------
--Sales by Category:
--Technology accounts for the largest share of revenue and generates the highest total profit, with a healthy profit margin (~17%).
--Office Supplies also deliver a strong margin (~17%) despite slightly lower revenue.
--Furniture generates substantial sales but very low profit (~2–3% margin), suggesting pricing or cost-related issues in this category.
SELECT
    category,
    ROUND(SUM(sales), 2)  AS total_sales,
    ROUND(SUM(profit), 2) AS total_profit
FROM orders_clean
GROUP BY category
ORDER BY total_sales DESC;
---------------------------------
--Monthly Trend:
--Insight1 (Peak season: Oct–Dec):Sales peak consistently in Q4 (Oct–Dec), driven by holiday promotions and end-of-year spending. November and December are the strongest months across all years.
--Insight2 (Margin compression in Q4): Profit does not scale proportionally with Q4 revenue. Heavy discounting and low-margin furniture sales reduce profit margins during peak sales months.
--Insight 3 Q1 (Jan–Mar): Q1 (Jan–Mar) shows the lowest activity, with February and January consistently representing the weakest sales months.
--Insight4 (High-margin months): Some mid-year months (e.g., Mar and Oct) show strong profitability despite moderate sales, indicating a more favorable product mix and reduced discounting.
--Insight 5 (Negative profit months): A few months (e.g., Jul 2014 and Jan 2015) show negative profit, suggesting excessive discounting or unprofitable transactions.
--Insight 6 (strongest year): 2017 shows the strongest performance overall, with consistently positive profit and the highest single-month revenue (Nov 2017: $118K).
SELECT
    order_year,
    order_month,
    order_year || '-' || order_month AS year_month,
    ROUND(SUM(sales), 2)  AS monthly_sales,
    ROUND(SUM(profit), 2) AS monthly_profit
FROM orders_clean
GROUP BY
    order_year,
    order_month
ORDER BY
    order_year,
    order_month;

	

---------------------------------
--Region Analysis:

--Insight 1:West is the strongest region, leading in both revenue (\$725K) and profit (\$108K) with the highest margin (14.9%). This suggests a favorable product mix and strong Technology sales.
-- Insight 2:East ranks second with strong revenue (\$678K) but a slightly lower margin (13.5%), likely due to heavier discounting or a less profitable category mix.
-- Insight 3:Central performs the weakest in profitability, with the highest average discount (24%) and the lowest margin (7.9%). Excessive discounting appears to erode profitability in this region.
-- Insight 4:South shows the lowest revenue, but maintains a healthier margin (11.9%) than Central, reflecting more controlled discounting.
-- Insight 5:Strong negative correlation between discount and margin: regions with higher discount rates consistently show lower profitability.
--Insight 6: Together, West + East account for over 60% of total revenue, making them the strategic core of the business.

SELECT
    region,
    COUNT(DISTINCT order_id)              AS total_orders,
    ROUND(SUM(sales), 2)                  AS total_sales,
    ROUND(SUM(profit), 2)                 AS total_profit,
    ROUND(AVG(discount), 4)               AS avg_discount,
    ROUND((SUM(profit) * 100.0 / SUM(sales)), 2) AS profit_margin_pct
FROM orders_clean
GROUP BY region
ORDER BY total_sales DESC;
----------------------------
--top 10 customers
--Tamara Chand is the most profitable customer, generating $8,981 in profit from only 5 orders, indicating a high-margin purchasing pattern.
--Raymond Buch and Sanjit Chand also contribute significantly to company profit, with strong margins despite moderate order counts.
--Some high-frequency customers (e.g., Keith Dawkins with 12 orders) generate lower total profit, suggesting smaller-ticket purchases or higher discounts.
--Profit does not correlate directly with sales volume—some customers generate high revenue but lower profit due to discounting or low-margin product categories.
--Top 10 customers collectively contribute over $50K in profit, accounting for roughly 17% of total company profitability.
--These insights can support targeted CRM strategies such as loyalty programs, personalized promotions, and selective discounting.
SELECT
    customer_id,
    customer_name,
    ROUND(SUM(sales), 2)  AS total_sales,
    ROUND(SUM(profit), 2) AS total_profit,
    COUNT(DISTINCT order_id) AS order_count
FROM orders_clean
GROUP BY customer_id, customer_name
ORDER BY total_profit DESC
LIMIT 10;
------------------------------
--top 10 customers with negative profit
--Insights
--Cindy Stewart is the most unprofitable customer, generating a loss of –$6,626 across 6 orders.
--Several customers such as Grant Thornton and Luke Foster produce losses above –$3,000, mostly due to heavy discounting and purchases in low-margin categories.
--Some of the most problematic customers exhibit high frequency but negative profit (e.g., Henry Goldwyn with 12 orders and Zuschuss Carroll with 13 orders), representing structural unprofitability.
--A few customers generate high sales but negative profit (e.g., Sean Miller with $25K revenue but –$1,980 profit), indicating margins severely eroded by discounts.
--Many low-frequency customers (1–2 orders) also show negative profit, suggesting lack of control in discounting policies.
--Collectively, unprofitable customers generate over –$70K in losses, a significant portion of the company's total margin.
--This analysis highlights the need for improved discount policies, customer segmentation, and targeted margin optimization strategies.
SELECT
    customer_id,
    customer_name,
    ROUND(SUM(sales), 2)  AS total_sales,
    ROUND(SUM(profit), 2) AS total_profit,
    COUNT(DISTINCT order_id) AS order_count
FROM orders_clean
GROUP BY customer_id, customer_name
HAVING SUM(profit) &lt; 0
ORDER BY total_profit ASC;
---------------------------------------






</sql><sql name="SQL 4*">--cleaning
CREATE VIEW orders_clean AS
SELECT
    &quot;Row ID&quot;        AS row_id,
    &quot;Order ID&quot;      AS order_id,
    &quot;Order Date&quot;    AS order_date_raw,
    &quot;Ship Date&quot;     AS ship_date_raw,
    &quot;Ship Mode&quot;     AS ship_mode,
    &quot;Customer ID&quot;   AS customer_id,
    &quot;Customer Name&quot; AS customer_name,
    Segment         AS segment,
    Country         AS country,
    City            AS city,
    State           AS state,
    &quot;Postal Code&quot;   AS postal_code,
    Region          AS region,
    &quot;Product ID&quot;    AS product_id,
    Category        AS category,
    &quot;Sub-Category&quot;  AS sub_category,
    &quot;Product Name&quot;  AS product_name,
    Sales           AS sales,
    Quantity        AS quantity,
    Discount        AS discount,
    Profit          AS profit,
--standard_date
	printf(
        '%04d-%02d-%02d',
        substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
        substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
        substr(&quot;Order Date&quot;,
            instr(&quot;Order Date&quot;, '/') + 1,
            instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
        )
    ) AS order_date,

--Add year and month columns for trend analysis
	strftime(
        '%Y',
        printf(
            '%04d-%02d-%02d',
            substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
            substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
            substr(
                &quot;Order Date&quot;,
                instr(&quot;Order Date&quot;, '/') + 1,
                instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
            )
        )
    ) AS order_year,
    strftime(
        '%m',
        printf(
            '%04d-%02d-%02d',
            substr(&quot;Order Date&quot;, length(&quot;Order Date&quot;) - 3, 4),
            substr(&quot;Order Date&quot;, 1, instr(&quot;Order Date&quot;, '/') - 1),
            substr(
                &quot;Order Date&quot;,
                instr(&quot;Order Date&quot;, '/') + 1,
                instr(substr(&quot;Order Date&quot;, instr(&quot;Order Date&quot;, '/') + 1), '/') - 1
            )
        )
    ) AS order_month
FROM &quot;Sample - Superstore&quot;;</sql><current_tab id="2"/></tab_sql></sqlb_project>
